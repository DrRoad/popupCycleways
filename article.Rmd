---
title: "Methods to prioritise pop-up active transport infrastructure: overview and findings from 10 UK cities"
author: "Robin Lovelace"
output: github_document
bibliography: references.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, cache = TRUE)
```

```{r, echo=FALSE, eval=FALSE}
citr::tidy_bib_file("article.Rmd", "~/uaf/allrefs.bib", file = "references.bib")
```



# RESEARCH QUESTIONS AND HYPOTHESIS

The Covid-19 pandemic has transformed all sectors of the economy, not least transport.
[Demand for long distance trips has plummetted](https://osf.io/preprints/socarxiv/v3g5d/) and [airline companies have gone bust](https://arxiv.org/abs/2004.08460) [@iacus_estimating_2020; @jittrapirom_exploratory_2020].
Yet short distance travel patterns have also changed greatly and there has been an uptick in cycling in some places [@harrabin_boom_2020].
There are two main explanations for increased active transport during pandemic-related physical distancing measures: 1) with fewer opportunities to exercise, more people are taking to walking, running and cycling in their local area for mental and physical health; and 2) public transport options have been greatly reduced due to cuts in services and fear of being infected while in enclosed spaces, meaning that walking and particularly cycling may be the only way that workers can reach key destinations such as hospitals.
The second reason is particularly important given that many 'key workers' are low paid and may have access to a working private automobile.
From a physical activity perspective this change is welcome: obesity is a powerful predictor of all-cause mortality, including from Covid-19 [@docherty_features_2020].
From a physical distancing perspective, increased levels of walking and cycling,
<!-- particularly in densly populated urban areas where pavements and cycleways may be narrow,  -->
the shift creates pressure on governments to ensure sufficient 'space for social distancing', while enabling increased active mobility for health and travel to key workplaces.

Local and national governments worldwide are still working out how best to respond to these changes and many options are available to ensure that citizens can benefit from outdoor activity while minimizing health risks, ranging from the provision of hand sanitisers to opening-up spaces such as parking lots and golf courses [@freeman_covid19_2020].
Many local governments have responded by implementing 'pop-up' active transport infrastructure, including:

1. 'filtered permeability' interventions to prevent through traffic
2. banning cars and to pedestrianise streets, greatly increasing the width of walkable space, New York's 'Open Streets' initiative being a prominent example [@litman_pandemicresilient_2020], and
3. from the through-flow of motor vehicles

The Scottish government, for example have provided emergency funding "to keep key workers moving" by "reallocating road space to better enable this shift and make it safer for people who choose to walk, cycle or wheel for essential trips or for exercise" [@transportscotland_10_2020].


Hundreds of kilometres of temporary infrastructure being put in place in dozens of cities worldwide, from [Park Lane in London](https://www.forbes.com/sites/carltonreid/2020/05/06/pop-up-cycleway-for-park-lane-as-tenfold-increase-in-cycling-predicted-for-london/#48aad0705b1e) to [Martin Luther King Jr Drive in Philadelphia](https://www.theguardian.com/world/2020/apr/11/world-cities-turn-their-streets-over-to-walkers-and-cyclists ""), [Auckland](https://www.roadtraffic-technology.com/news/nz-govt-extra-wide-footpaths/) to [Mexico City](https://bicitekas.org/sites/default/files/public/manuales/propuesta_ciclovias_temporales_cdmxvfinal.pdf), never has there been such a need for affordable, healthy and socially isolated transport that does not create the fumes that emerging evidence links to coronavirus susceptibility. With the rush to act, there is a great need for evidence of *where* new interventions should be prioritised. As with the medical science, research is needed now. Methods developed to identify locations of high walking and cycling potential can help ensure that the ‘pop-up’ infrastructure that goes in now is effective, safe, and placed where it is most needed.


# METHODS AND DATA

```{r load}
library(sf)
library(tidyverse)
library(tmap)
u = "https://github.com/cyipt/tempCycleways/releases/download/0.1/rsf_leeds.Rds"
r_original = readRDS(url(u))
ur = "https://github.com/cyipt/tempCycleways/releases/download/0.1/rtid.csv"
rtid = readr::read_csv(ur)
```

```{r parameters}
min_pctgov = 0
min_grouped_pctgov = 100
min_grouped_length = 500
city_centre_buffer_radis = 8000
city_centre = tmaptools::geocode_OSM("leeds", as.sf = TRUE)
city_centre_buffer = stplanr::geo_buffer(city_centre, dist = 8000)
```

```{r preprocess}
rj = inner_join(r_original, rtid)
# remove motorways
r = rj %>% 
  filter(!grepl(pattern = "motorway", x = highway))
cy = r %>% filter(highway == "cycleway")
```



## Levels of analysis

An important distinction when developing methods for automated analysis of transport networks is the level of analysis.

```{r levels}
r_pct_lanes = r %>% 
  filter(pctgov > min_pctgov) %>% 
  filter((lanespsvforward + lanesforward) > 1 |
      (lanespsvbackward + lanesbackward) > 1
  )
touching_list = st_touches(r_pct_lanes)
g = igraph::graph.adjlist(touching_list)
components = igraph::components(g)
r_pct_lanes$group = components$membership
r_pct_lanes = r_pct_lanes %>% 
  group_by(group) %>% 
  mutate(group_length = sum(length)) %>% 
  mutate(pctgov_mean = mean(pctgov, na.rm = TRUE)) %>% 
  filter(pctgov_mean > min_grouped_pctgov)
r_pct_lanes = r_pct_lanes %>% filter(group_length > min_grouped_length)
r_filter_before_grouping = r %>% 
  filter(pctgov > min_pctgov) %>% 
  filter((lanespsvforward + lanesforward) > 1 |
           (lanespsvbackward + lanesbackward) > 1
  ) %>% 
  filter(pctgov > min_grouped_pctgov) %>% 
  filter(length > 100)
tmap_mode("plot")
m1 = tm_shape(city_centre_buffer) + tm_borders(col = "grey") +
  tm_shape(r_filter_before_grouping) + tm_lines() +
  tm_layout(title = "Filter then group (length > 100, cycling_potential > 100)")
m2 = tm_shape(city_centre_buffer) + tm_borders(col = "grey") +
  tm_shape(r_pct_lanes) + tm_lines() +
  tm_layout(title = "Group then filter (length > 500, cycling_potential > 100)")
ma = tmap_arrange(m1, m2)
ma
```


```{r}
```



# FINDINGS


<!-- Guidance from https://transportfindings.org/for-authors -->

<!-- Transport Findings welcomes research findings in the broad field of transport. Articles must either pose a New Question,  present a New Method, employ New Data (including New Contexts or Locations),  discover a New Finding (i.e. it can almost exactly replicate a previous study and find something different), or some combination of the above. -->
<!-- Scope -->

<!-- You may find yourself asking if your paper is within the scope of Transport Findings. -->

<!--     Is there a hypothesis somehow related to transport? -->
<!--     Is there a (scientifically valid, replicable) methodology? -->
<!--     Is there a finding? -->

<!-- If you can answer yes to these questions, it is within scope. -->
<!-- Article Types -->

<!--     Findings - where the object of study is nature -->
<!--     Syntheses - where the object of study is the literature -->
<!--     Cases - where the objects of study are particular sites or projects, and methods may be more qualitative -->

<!-- Sections -->

<!-- All articles shall have 3 sections, and only 3 sections, titled as follows: -->

<!--     RESEARCH QUESTION[S] AND HYPOTHESIS[ES] -->
<!--     METHODS AND DATA -->
<!--     FINDINGS -->

<!-- There shall be no introduction, “road-map paragraph,” literature review, conclusions, speculations, or  policy implications beyond what is included above. Focus on what you found, not why you found it. -->
<!-- Submissions -->

<!-- The manuscript submission must include the following: -->
<!-- TITLE -->
<!-- AUTHORS (NAME, AFFILIATION, CONTACT) -->
<!-- ABSTRACT -->
<!-- KEYWORDS -->
<!-- ARTICLE (Sections 1, 2, 3) -->
<!-- ACKNOWLEDGMENTS -->
<!-- REFERENCES -->

<!-- Manuscript submissions may include SUPPLEMENTAL INFORMATION in separate files that do not count against article length. This information should not be essential for the general understanding of the manuscript. -->
<!-- Style -->
<!-- Focus and Parsimony -->

<!-- Papers should be focused and to the point, and not begin with trite observations like “Congestion is a problem the world over.” Usually you can delete your opening paragraph if it begins like that, and the reader is no worse off. As Strunk and White say: “Omit Needless Words”. The Abstract should not say the same thing as the Introduction. -->
<!-- Transparency and Replicability -->

<!-- A minimum standard for a good paper is transparency and replicability: Can the reader understand what you did, and repeat it, and get the same answer? -->
<!-- Mathematical Conventions -->

<!-- Each variable shall have one, and only one, definition per document. -->

<!-- Each defined term in the document shall be represented by one and only one variable. -->

<!-- Lowercase and uppercase versions of the same letter should be logically related. For instance, use lowercase letters to define the PDF (probability distribution function) or individual instance, and uppercase letters the CDF (cumulative distribution function) or population, so when you sum:  i=1 to I, k=1 to K, etc. -->

<!-- All variables shall be a single letter or symbol. Double or triple letter variables can be confused with multiplication. If you have more than 52 symbols in your paper (26 letters for both lower and upper case), consider (a) there are too many, and (b) using Greek or Hebrew characters. -->

<!-- Use subscripts liberally to differentiate things that, for instance, are of a class but measured differently, or computed with different assumptions. -->

<!-- All equations shall have all of their variables defined. -->